<?xml version="1.0" encoding="utf-8" ?>
<!---Code written by Prajeet Bohara with the help of contenview template provided by .NET MAUI
This code file gives UI for the top navigation bar that will be present throughout all the pages-->
    
<!-- DynamicResouce are used from the app.xaml files which is the global resource file for the project-->

<ContentView
    x:Class="Dashboard.Controls.TopBar"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    BackgroundColor="{DynamicResource TopBarBackground}"
    HeightRequest="80"
    Padding="20,16,20,16"
    VerticalOptions="Start"
    IsClippedToBounds="False">
    
    <Grid RowDefinitions="Auto,Auto">
        <!-- Main bar content -->
        <Grid x:Name="TopBarLayout"
              Grid.Row="0"
              ColumnDefinitions="Auto,12,Auto,12,Auto,*,20,Auto,20,Auto,20,Auto" 
              RowDefinitions="Auto" 
              VerticalOptions="Center">
            
            <!-- Hamburger Menu Icon -->
            <Grid Grid.Column="0" 
                  WidthRequest="40" 
                  HeightRequest="40" 
                  VerticalOptions="Center">
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnMenuTapped" />
                </Grid.GestureRecognizers>
           
                <VerticalStackLayout Spacing="3" 
                                    HorizontalOptions="Center" 
                                    VerticalOptions="Center">
                    <BoxView HeightRequest="3" 
                             WidthRequest="20" 
                             CornerRadius="1.5" 
                             BackgroundColor="{DynamicResource TopBarForeground}" />
                    <BoxView HeightRequest="3" 
                             WidthRequest="20" 
                             CornerRadius="1.5" 
                             BackgroundColor="{DynamicResource TopBarForeground}" />
                    <BoxView HeightRequest="3" 
                             WidthRequest="20" 
                             CornerRadius="1.5" 
                             BackgroundColor="{DynamicResource TopBarForeground}" />
                </VerticalStackLayout>
            </Grid>

            <!-- Home Icon -->
            <Grid Grid.Column="2" 
                  WidthRequest="80" 
                  HeightRequest="40" 
                  VerticalOptions="Center">
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnHomeTapped" />
                </Grid.GestureRecognizers>
                <Grid ColumnDefinitions="Auto,Auto" 
                      VerticalOptions="Center">
                    <Grid Grid.Column="0"
                          WidthRequest="24" 
                          HeightRequest="24" 
                          VerticalOptions="Center"
                          Margin="0,0,8,0">
                        <Path Data="M12,2 L22,8 L22,20 L14,20 L14,14 L10,14 L10,20 L2,20 L2,8 Z" 
                              Fill="{DynamicResource TopBarBackground}" 
                              Stroke="{DynamicResource TopBarBackground}" 
                              StrokeThickness="1" />
                    </Grid>
                </Grid>
            </Grid>

            <!-- Department Title -->
            <Label Grid.Column="4"
                   Text="Department of Engineering &amp; Computer Science"
                   FontSize="{OnPlatform Default=14, Android=12, iOS=12}"
                   FontAttributes="Bold"
                   TextColor="{DynamicResource TopBarForeground}"
                   VerticalTextAlignment="Center"
                   HorizontalTextAlignment="Start"
                   LineBreakMode="TailTruncation"
                   WidthRequest="280"
                   MaxLines="1" />

            <!-- Search Bar -->
            <Grid Grid.Column="7"
                  x:Name="SearchBarContainer"
                  VerticalOptions="Center"
                  HorizontalOptions="Start"
                  WidthRequest="200">
                <Frame BackgroundColor="{DynamicResource TopBarSearchBackground}"
                       CornerRadius="20"
                       Padding="0"
                       HasShadow="False"
                       VerticalOptions="Center">
                    <Grid ColumnDefinitions="Auto,*" 
                          VerticalOptions="Center"
                          Padding="0">
                        <Label Grid.Column="0"
                               Text="ðŸ”"
                               FontSize="16"
                               TextColor="{DynamicResource TopBarPlaceholder}"
                               VerticalTextAlignment="Center"
                               Margin="12,0,8,0" />
                        <Entry Grid.Column="1"
                               x:Name="SearchEntry"
                               Placeholder="Search the dashboard..."
                               ClearButtonVisibility="WhileEditing"
                               BackgroundColor="Transparent"
                               TextColor="{DynamicResource TopBarForeground}"
                               PlaceholderColor="{DynamicResource TopBarPlaceholder}"
                               FontSize="14"
                               HeightRequest="36"
                               Margin="0,0,12,0"
                               ReturnType="Search"
                               Focused="OnSearchFocused"
                               Unfocused="OnSearchUnfocused"
                               TextChanged="OnSearchTextChanged"
                               Completed="OnSearchCompleted" />
                    </Grid>
                </Frame>
            </Grid>

            <!-- Weather Information (Icon + Text) -->
            <Grid Grid.Column="9" 
                  ColumnDefinitions="Auto,Auto" 
                  VerticalOptions="Center"
                  HorizontalOptions="End">
                <Image x:Name="WeatherIcon"
                       Grid.Column="0"
                       WidthRequest="24"
                       HeightRequest="24"
                       Margin="0,0,8,0"
                       VerticalOptions="Center" />
                <Label Grid.Column="1"
                       x:Name="WeatherLabel"
                       Text="72Â°F â€¢ Partly Cloudy"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{DynamicResource TopBarForeground}"
                       VerticalTextAlignment="Center"
                       HorizontalTextAlignment="End" />
            </Grid>

            <!-- Current date and time-->
            <Label Grid.Column="11"
                   x:Name="ClockLabel"
                   Text="Sep 19 â€¢ 04:16:45 PM"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="{DynamicResource TopBarForeground}"
                   VerticalTextAlignment="Center"
                   HorizontalTextAlignment="End" />
        </Grid>

        <!-- Search Overlay -->
        <Grid x:Name="SearchOverlay"
              Grid.Row="1"
              IsVisible="False"
              Padding="0"
              InputTransparent="False"
              ZIndex="9999">
            <BoxView BackgroundColor="#80000000">
                <BoxView.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnSearchOverlayBackgroundTapped" />
                </BoxView.GestureRecognizers>
            </BoxView>

            <Border x:Name="SearchOverlayCard"
                    BackgroundColor="#1F2937"
                    StrokeThickness="1"
                    Stroke="#374151"
                    StrokeShape="RoundRectangle 8"
                    Padding="0"
                    HorizontalOptions="Center"
                    VerticalOptions="Start"
                    WidthRequest="380"
                    Margin="0,12,0,20">
                <Grid RowDefinitions="Auto,*"
                      BackgroundColor="#1F2937">
                    <Grid ColumnDefinitions="*,Auto"
                          Padding="16,10"
                          BackgroundColor="#111827">
                        <Label Text="Search results"
                               FontAttributes="Bold"
                               FontSize="16"
                               TextColor="White"
                               VerticalOptions="Center" />
                        <Button Grid.Column="1"
                                Text="Close"
                                Padding="12,4"
                                FontSize="12"
                                BackgroundColor="#374151"
                                TextColor="White"
                                Clicked="OnCloseSearchOverlayClicked" />
                    </Grid>

                    <Grid RowDefinitions="*"
                          Padding="0"
                          RowSpacing="0"
                          BackgroundColor="#1F2937">
                        <ScrollView x:Name="SearchResultsScrollView"
                                    IsVisible="False"
                                    MaximumHeightRequest="420">
                            <VerticalStackLayout x:Name="SearchResultsContainer"
                                                 Spacing="0"
                                                 Padding="0" />
                        </ScrollView>

                        <ActivityIndicator x:Name="SearchLoadingIndicator"
                                           IsVisible="False"
                                           IsRunning="False"
                                           Color="#FFD204"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"
                                           HeightRequest="40"
                                           WidthRequest="40" />

                        <Label x:Name="SearchEmptyLabel"
                               Text="Start typing to search..."
                               TextColor="#D1D5DB"
                               FontSize="14"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Padding="20"
                               IsVisible="True" />
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</ContentView>
